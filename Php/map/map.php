<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mappa</title>
</head>

<style>
    body {
        text-align: center;
        align-content: center;
    }

    pre {
        padding: 5px;
        font-size: large;
        border: solid black;
        border-style: double;
        border-width: thick;
        width: fit-content;
        justify-self: center;
    }

    .button {
        min-width: fit-content;
        width: 4vw;
    }

    .error {
        font-family: monospace;
        font-size: large;
        color: red;
    }
</style>

<body>
    <?php
    $mappa = [['P','T','.','.','~','#','.','.','.','#','#','#','.','.','~','~','#','.','.','~','.','.','.','~','.','.','~','#','.','#','#','#','~','#','T','~','~','.','~','.','~','.','#','~','#','.','~','~','#','.','.','#','.','.','.','#','T','.','#','#',],
    ['#','~','.','~','#','T','.','.','T','T','#','#','.','.','~','T','#','.','.','~','.','.','#','.','~','#','.','.','#','#','#','~','#','.','.','#','.','.','.','.','#','.','T','T','.','~','T','T','.','.','~','#','~','.','~','#','T','~','.','.',],
    ['#','#','.','T','#','.','.','.','#','.','.','#','.','~','.','.','#','.','~','T','#','.','~','.','T','.','#','~','#','#','.','.','.','T','#','#','.','.','.','#','.','#','.','.','#','.','T','~','#','.','T','.','.','~','.','~','.','~','.','#',],
    ['T','.','~','.','~','~','~','.','#','.','#','~','.','~','~','#','#','#','.','.','.','.','~','#','.','~','.','#','~','#','~','.','#','#','.','~','~','T','~','#','.','.','~','.','#','~','~','#','.','#','#','~','#','.','T','.','.','#','.','.',],
    ['.','.','T','~','~','#','T','#','~','#','#','#','#','T','#','.','.','T','~','#','~','~','#','.','~','T','~','.','.','.','#','#','.','.','#','#','.','T','T','#','#','T','#','.','#','.','~','.','.','.','#','.','#','.','.','.','.','~','~','.',],
    ['~','.','#','.','.','#','#','~','.','.','T','#','.','.','T','#','.','.','~','.','~','T','.','.','.','#','#','.','.','#','.','.','.','~','~','.','~','.','.','~','.','~','#','#','~','T','.','T','~','.','.','#','T','.','.','#','.','.','#','#',],
    ['~','~','.','.','~','~','T','#','.','T','#','~','~','#','#','.','~','.','.','#','.','#','T','~','~','#','.','~','.','~','.','~','#','.','~','#','.','.','~','.','~','.','.','.','#','~','#','#','.','T','.','T','~','T','.','#','.','#','~','#',],
    ['#','.','.','T','~','.','#','T','~','.','.','.','.','#','#','~','~','~','.','.','.','~','.','T','~','.','.','#','#','.','#','.','~','.','#','~','~','~','~','.','#','.','.','.','#','.','#','#','.','~','.','~','.','.','.','#','.','.','T','.',],
    ['T','.','.','.','.','#','~','#','~','.','.','.','#','T','~','.','.','#','T','T','~','T','#','.','.','#','T','.','.','#','.','.','#','#','.','T','#','T','.','.','.','T','~','~','~','.','~','~','~','#','.','#','.','~','~','~','~','#','.','.',],
    ['#','.','.','~','T','.','T','~','#','~','.','.','.','T','#','.','.','T','~','.','.','.','T','~','.','T','T','#','.','#','.','.','#','.','.','.','~','~','#','#','.','.','T','.','T','#','.','#','#','T','#','#','~','~','~','~','~','#','#','T',],
    ['#','.','#','~','.','~','#','.','~','~','~','~','.','.','T','.','~','.','#','.','#','T','.','~','.','~','#','#','.','.','.','~','.','.','T','.','.','~','T','#','T','.','.','.','#','#','.','.','~','.','~','.','.','#','.','.','#','#','~','.',],
    ['.','.','.','T','~','T','~','#','#','.','#','#','.','~','T','.','#','#','.','.','#','~','#','~','.','~','T','.','T','~','~','#','#','#','#','.','.','.','#','#','~','T','.','#','~','.','#','.','.','.','.','.','T','.','~','#','~','.','.','#',],
    ['~','.','T','~','#','.','#','T','~','.','#','.','~','~','#','#','~','.','.','~','~','#','~','~','#','T','~','T','.','T','T','.','#','~','~','~','.','#','.','#','T','.','#','.','~','T','T','#','.','.','~','T','.','~','.','~','#','~','.','#',],
    ['.','.','T','#','T','.','.','#','#','#','~','#','~','T','#','~','.','.','T','.','~','~','~','#','T','~','#','#','~','.','~','~','.','#','~','.','~','~','T','#','#','~','#','~','.','~','#','.','T','#','.','.','~','T','.','~','T','~','T','.',],
    ['#','#','.','~','T','T','#','.','T','.','.','#','T','#','~','#','~','#','.','~','.','.','#','.','~','#','~','T','~','#','#','.','#','#','~','#','~','#','.','~','~','#','.','.','~','#','~','.','~','.','#','.','.','#','~','~','.','#','~','~',],
    ['#','T','~','#','~','~','~','#','T','.','~','.','.','T','.','.','#','T','#','~','#','#','#','.','T','~','#','.','.','#','#','~','#','#','.','#','#','~','.','.','#','.','.','.','T','.','~','.','#','T','~','.','~','.','#','T','.','#','T','T',],
    ['~','.','#','.','~','T','.','.','.','#','#','~','~','#','.','#','#','~','#','#','~','T','#','T','.','.','~','T','T','~','~','.','.','T','.','#','T','~','T','#','T','.','~','#','.','#','.','#','.','.','.','~','.','T','#','~','.','#','~','T',],
    ['#','T','~','#','.','T','~','T','~','.','#','.','.','#','~','.','#','.','.','~','#','#','.','.','T','#','T','.','.','T','.','#','#','~','T','.','~','#','#','.','.','.','.','#','.','T','#','~','.','.','T','~','#','T','.','#','T','.','.','T',],
    ['#','~','~','~','~','.','T','.','#','~','.','T','.','.','#','#','~','#','.','.','#','~','.','#','~','~','.','.','.','#','#','#','~','.','.','.','.','#','~','#','.','T','T','T','#','~','#','T','~','.','.','.','T','.','.','.','~','#','.','~',],
    ['T','~','T','.','.','~','.','.','.','~','.','T','#','.','.','.','#','#','#','~','T','~','T','.','#','#','~','.','.','#','~','~','T','.','~','#','.','.','.','#','.','.','.','#','~','.','~','.','~','#','#','~','.','~','.','#','#','.','.','.',],
    ['.','#','#','~','T','#','#','~','~','.','.','T','~','#','~','#','#','#','~','.','.','~','#','.','.','#','.','~','T','#','#','.','.','.','#','.','T','.','.','~','.','T','#','T','T','#','.','#','.','#','.','.','.','~','#','~','~','~','#','.',],
    ['~','T','#','.','~','T','.','#','.','.','~','~','#','.','T','.','T','~','.','~','T','.','.','~','T','#','#','#','~','T','.','~','#','.','~','~','#','.','~','.','#','.','T','#','~','~','.','.','.','.','.','#','.','.','T','#','~','.','T','#',],
    ['#','~','#','~','~','.','T','.','~','#','.','#','#','T','.','T','~','~','#','.','#','.','.','T','#','.','~','~','.','~','.','.','.','~','~','T','#','.','T','~','#','~','#','.','.','#','.','~','#','#','.','.','T','.','#','~','~','.','#','~',],
    ['~','.','#','#','T','~','#','~','#','.','.','#','~','.','#','~','.','.','.','~','T','.','~','#','#','~','~','#','#','~','.','~','#','#','#','#','~','~','.','~','T','.','~','T','.','~','#','.','~','#','.','.','~','~','.','~','.','~','.','.',],
    ['~','~','~','#','#','#','.','#','#','~','.','~','T','T','T','.','~','T','#','#','T','T','#','T','.','.','#','T','~','.','~','.','#','~','#','~','.','.','#','.','#','~','~','#','.','~','~','.','~','.','~','#','~','#','#','T','~','.','#','.',],
    ['~','.','#','#','.','.','~','~','#','T','~','.','~','#','.','~','.','#','.','#','.','.','T','.','.','T','.','.','.','T','~','#','.','T','~','.','.','#','.','~','T','#','#','~','~','.','#','#','.','.','~','#','~','#','.','T','.','T','~','~',],
    ['~','~','.','~','#','.','T','T','#','.','#','#','#','#','.','.','.','~','~','T','~','~','.','.','~','.','.','T','T','#','.','~','~','~','T','T','.','#','T','#','.','.','#','#','~','T','#','.','~','.','T','~','.','#','.','#','~','T','#','~',],
    ['#','~','.','~','~','#','#','#','~','.','.','~','T','#','~','.','T','#','.','T','~','.','#','~','~','~','~','.','.','~','.','T','~','~','#','.','~','T','T','.','~','.','T','~','~','.','.','.','~','~','~','~','~','.','.','.','.','.','#','.',],
    ['#','~','~','#','.','.','#','T','.','.','#','.','T','.','~','.','~','#','.','~','~','.','#','.','.','.','.','.','#','T','T','.','.','~','.','#','~','#','.','.','.','~','#','T','~','#','#','#','T','#','.','.','.','~','~','~','.','#','~','.',],
    ['T','.','.','~','.','.','.','.','T','.','~','T','#','T','.','~','~','.','T','~','T','.','T','.','T','T','.','.','.','.','~','~','#','.','~','#','~','~','T','.','~','#','~','#','~','#','.','.','T','T','~','.','~','#','.','#','~','T','~','.',],
    ['~','.','#','#','#','#','~','~','~','T','.','T','#','T','.','#','.','#','#','.','.','.','~','.','.','T','#','#','T','.','~','~','.','#','~','.','~','#','#','~','~','T','.','~','~','.','#','#','.','.','~','.','.','#','T','#','.','~','#','.',],
    ['~','~','#','~','~','~','.','#','~','.','T','#','.','.','.','.','~','.','~','~','~','#','.','~','~','~','T','#','#','.','T','.','.','.','.','.','#','#','~','.','T','#','~','#','#','#','T','~','.','#','T','.','#','T','~','T','~','T','T','.',],
    ['#','T','~','.','.','#','T','T','.','.','~','#','.','.','#','#','~','~','#','.','#','~','#','~','T','#','.','.','.','~','~','.','#','#','.','~','#','#','T','.','#','.','.','.','#','.','.','.','~','~','~','~','.','#','.','#','T','#','#','#',],
    ['~','.','~','#','T','~','~','.','.','#','.','.','#','T','.','.','#','.','T','#','T','~','#','#','#','#','#','#','.','.','T','#','.','~','.','.','#','.','~','.','.','.','#','~','~','.','~','~','#','~','~','T','.','#','.','~','~','.','T','.',],
    ['.','.','.','T','.','.','.','~','.','.','#','.','.','#','#','#','.','T','~','T','#','#','T','#','.','.','#','.','~','.','#','#','~','.','#','#','~','T','.','T','.','~','#','~','.','.','~','T','.','.','#','.','~','T','.','#','~','~','#','~',],
    ['~','~','.','~','.','#','.','~','.','#','.','~','T','.','T','~','~','T','~','#','T','.','~','~','~','~','T','#','.','.','#','#','T','#','#','.','T','#','#','.','.','.','.','#','T','.','.','.','~','~','~','#','.','T','.','~','#','~','.','.',],
    ['~','T','T','#','T','~','T','#','.','#','#','~','.','.','#','~','.','.','.','T','#','~','.','~','~','.','#','.','.','#','~','.','~','#','~','#','T','#','~','#','.','T','.','~','.','.','#','#','~','.','.','T','.','.','~','T','.','~','.','#',],
    ['.','~','.','.','.','.','.','T','.','.','.','#','~','#','.','T','#','.','.','~','.','.','~','.','#','.','~','#','#','~','~','#','#','.','~','.','T','T','.','~','~','.','.','.','.','.','#','.','~','.','~','.','#','~','.','#','~','.','~','~',],
    ['.','~','#','.','.','.','~','T','~','.','#','.','.','.','~','~','#','T','#','.','T','~','T','~','.','T','T','~','T','T','#','.','#','~','.','#','#','T','#','T','.','#','T','T','T','#','.','.','.','.','.','#','.','T','#','.','.','.','~','.',],
    ['.','#','.','.','.','#','.','.','~','.','#','.','~','T','~','T','#','.','.','#','.','~','.','.','#','.','#','T','.','.','T','.','.','T','~','.','#','.','.','#','T','~','~','.','.','.','.','.','#','~','#','~','.','#','.','.','~','T','T','#',],
    ['~','.','~','.','.','~','~','.','#','~','.','.','.','~','~','.','T','~','#','#','#','#','.','.','~','.','.','#','T','T','~','~','E','~','~','.','#','.','#','T','~','#','~','~','.','#','.','#','~','#','.','~','.','#','#','~','#','#','.','.',],
    ['T','#','#','.','.','T','T','.','.','T','~','T','T','T','T','~','~','#','.','.','.','.','T','#','T','.','.','~','.','#','~','T','.','.','~','#','.','.','T','#','T','.','.','.','.','#','.','.','#','~','.','~','.','~','~','~','.','.','.','~',],
    ['#','.','#','.','.','.','T','.','#','.','.','.','.','#','~','.','.','.','.','.','#','#','#','~','.','~','#','#','T','#','#','#','.','~','.','#','T','T','.','#','~','.','.','.','#','#','~','.','.','#','.','~','.','~','.','.','~','~','.','.',],
    ['~','#','~','.','.','~','.','.','#','.','.','.','#','.','T','#','.','~','#','~','.','#','.','T','.','.','T','.','~','.','#','~','.','~','#','.','~','~','.','~','#','T','T','#','.','#','.','~','.','#','#','T','#','.','#','#','#','#','.','#',],
    ['~','.','.','.','~','~','~','#','#','#','.','#','~','.','T','.','.','~','.','~','.','#','~','.','.','T','.','#','#','#','~','~','~','T','.','T','.','#','#','.','#','T','#','.','T','~','#','#','#','~','.','.','.','T','~','.','~','~','.','.',],
    ['T','.','.','T','.','~','.','#','#','~','~','#','.','.','.','T','.','.','.','#','T','.','~','.','~','~','.','#','~','T','.','.','~','.','.','~','~','#','#','#','T','#','.','.','~','~','T','~','~','#','T','.','T','T','#','#','#','~','~','.',],
    ['#','#','.','.','~','.','T','~','~','.','.','T','~','.','.','#','T','#','~','T','.','.','#','T','~','#','~','T','.','#','.','.','.','#','.','#','~','T','#','~','.','.','.','#','#','.','#','#','.','~','#','.','#','~','.','#','#','.','.','#',],
    ['#','~','T','.','~','T','.','~','#','.','.','.','~','.','.','T','T','#','T','.','#','.','.','.','.','.','#','#','.','T','T','#','.','.','T','.','~','T','#','T','.','~','.','~','~','.','.','.','#','#','T','.','.','.','~','T','T','.','~','~',],
    ['.','.','.','#','T','.','#','.','.','.','~','#','#','#','~','.','T','.','.','.','~','T','.','.','~','.','.','~','~','#','T','.','~','.','.','.','~','#','#','~','.','.','#','~','.','.','.','.','.','#','#','.','T','#','.','~','.','#','~','.',],
    ['.','#','~','#','T','#','T','.','.','T','~','.','.','.','~','~','.','.','~','T','~','~','#','~','.','.','T','.','.','#','T','.','~','T','~','#','#','~','#','T','.','#','#','.','~','.','~','#','#','.','.','~','.','.','#','#','#','.','#','.',],
    ['.','.','#','#','.','.','.','#','T','.','T','.','.','.','T','#','.','.','.','.','#','#','#','~','.','.','.','.','#','.','.','#','#','.','.','.','#','~','#','~','.','~','.','~','.','#','.','#','.','~','.','~','.','T','.','.','.','.','.','~',],
    ['T','.','#','~','#','~','.','#','~','~','.','~','~','.','#','~','T','T','~','.','#','#','~','#','#','.','.','~','~','T','.','#','.','~','.','#','#','.','T','#','.','~','#','.','~','#','.','.','#','.','~','#','.','#','#','.','~','#','.','#',],
    ['.','.','~','~','#','~','.','.','~','T','#','.','~','.','#','.','~','.','~','.','~','.','#','~','.','.','.','.','.','#','#','#','.','~','.','~','#','.','.','T','T','.','~','#','#','#','~','.','~','.','~','#','#','.','~','#','#','T','.','.',],
    ['.','.','T','~','.','.','~','.','~','.','.','~','.','T','~','~','#','.','.','.','~','.','.','#','T','#','~','.','.','~','~','~','~','#','~','.','.','T','.','~','#','~','~','T','.','.','.','T','~','.','.','.','T','T','.','~','.','#','.','.',],
    ['~','~','.','.','#','#','T','#','~','.','~','T','#','.','T','~','#','#','#','~','~','#','~','.','T','.','#','T','.','.','#','.','.','T','#','~','~','#','~','T','.','#','.','~','~','#','~','~','.','~','~','#','T','#','~','.','.','.','~','~',],
    ['T','.','~','.','~','.','.','.','.','T','~','.','#','.','#','T','#','~','~','~','.','.','.','T','#','.','T','.','.','.','.','~','~','~','#','.','.','~','T','#','~','~','#','~','.','T','#','#','.','T','~','.','.','.','#','.','~','.','#','#',],
    ['.','~','T','#','.','#','~','#','~','T','.','#','~','~','~','.','~','.','.','#','~','.','~','.','.','.','T','#','~','~','.','.','.','.','#','.','~','.','~','#','~','#','~','#','~','.','.','.','~','~','~','.','#','~','~','#','.','~','.','T',],
    ['.','.','~','.','#','#','.','.','#','~','#','.','T','#','.','~','#','.','~','~','#','#','~','~','~','#','#','#','.','#','T','T','.','T','#','~','#','#','~','#','.','~','~','#','#','T','~','.','~','T','~','#','~','.','.','#','.','T','.','T',],
    ['T','.','.','T','#','.','#','#','#','~','T','#','.','T','#','#','.','T','.','.','#','T','~','T','.','.','#','T','.','#','.','~','.','.','~','#','T','~','~','#','~','~','#','#','#','#','T','~','#','T','~','T','#','~','.','T','.','#','.','~',],
    ['.','~','~','#','T','#','~','#','#','.','#','.','~','~','T','~','~','.','#','~','#','.','T','~','~','~','T','.','.','#','#','.','.','.','#','.','T','.','.','.','#','#','~','.','#','.','~','.','~','#','~','.','.','#','~','.','T','~','~','.',]
    ];

    $punteggio = 0;
    if (isset($_POST['punteggio'])) {
        $punteggio = $_POST['punteggio'];
    }

    $x = 0;
    $y = 0;
    $mappa[0][0] = '.';
    if (isset($_POST['x']) && isset($_POST['y'])) {
        $x = $_POST['x'];
        $y = $_POST['y'];
    }

    if (isset($_POST['reset'])) {
        $punteggio = 0;
        $x = 0;
        $y = 0;
    }

    function uscita()
    {
        echo '<style>
                .move {
                    visibility: hidden;
                    width: 0px;
                    height: 0px;
                }
            </style>';
    }

    $prevX = $x;
    $prevY = $y;
    $err = '';
    if (isset($_POST['dir'])) {
        switch ($_POST['dir']) {
            case 'nord':
                $y--;
                break;
            case 'ovest':
                $x--;
                break;
            case 'sud':
                $y++;
                break;
            case 'est':
                $x++;
                break;
        }
        if ($y < 0 || $y > count($mappa) - 1) {
            $y = $prevY;
            $err = 'Out of bounds';
        }
        if ($x < 0 || $x > count($mappa[0]) - 1) {
            $x = $prevX;
            $err = 'Out of bounds';
        }
        if ($err == '')
            switch ($mappa[$y][$x]) {
                case '.':
                    $punteggio++;
                    break;
                case '#':
                    $punteggio--;
                    break;
                case '~':
                    $punteggio -= 2;
                    break;
                case 'T':
                    $punteggio += 2;
                    break;
                case 'E':
                    uscita();
                    break;
            }
    }
    $mappa[$y][$x] = 'P';

    function stampaMappa($mappa)
    {
        echo "<pre>";
        foreach ($mappa as $riga) {
            echo implode(" ", $riga) . "\n";
        }
        echo "</pre>";
    }

    stampaMappa($mappa);
    echo "Punteggio " . $punteggio . "<br>";
    echo "<span class=\"error\">$err</span><br><br>";
    ?>

    <form method="post">
        <input type="hidden" id="punteggio" name="punteggio" value="<?php echo $punteggio; ?>" />
        <input type="hidden" id="x" name="x" value="<?php echo $x; ?>" />
        <input type="hidden" id="y" name="y" value="<?php echo $y; ?>" />

        <div>
            <div>
                <input type="submit" class="move button" name="dir" id="nord" value="nord" />
            </div>
            <input type="submit" class="move button" name="dir" id="ovest" value="ovest" />
            <input type="submit" class="move button" name="dir" id="sud" value="sud" />
            <input type="submit" class="move button" name="dir" id="est" value="est" />
        </div>
        <br>
        <input type="submit" class="button" name="reset" id="reset" value="reset" />
    </form>
</body>

</html>